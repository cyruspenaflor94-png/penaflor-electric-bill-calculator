<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Change Password</title>
    <link rel="stylesheet" href="change-password.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase.config.js"></script>
</head>
<body>

<div class="container">
    <h1>Change Password</h1>

    <div class="form-group">
        <label>Current Password</label>
        <input type="password" placeholder="Enter current password">
    </div>

    <div class="form-group">
        <label>New Password</label>
        <input type="password" placeholder="Enter new password">
    </div>

    <div class="form-group">
        <label>Confirm Password</label>
        <input type="password" placeholder="Confirm new password">
    </div>

    <div class="btn-container">
        <a href="profile.html" class="back-button btn">Back</a>
        <button class="save-button btn" onclick="handleChangePassword()">Save</button>
    </div>
</div>

<script>
// Initialize Supabase on page load
document.addEventListener('DOMContentLoaded', async function() {
    initializeSupabase();
    
    // Check authentication
    const user = await getCurrentUser();
    if (!user) {
        window.location.href = 'login.html';
        return;
    }
});

async function handleChangePassword() {
    const currentPassword = document.querySelector('input[type="password"]:nth-of-type(1)').value;
    const newPassword = document.querySelector('input[type="password"]:nth-of-type(2)').value;
    const confirmPassword = document.querySelector('input[type="password"]:nth-of-type(3)').value;

    // Validate inputs
    if (!currentPassword || !newPassword || !confirmPassword) {
        alert("❌ Please fill out all fields");
        return;
    }

    if (newPassword.length < 6) {
        alert("❌ New password must be at least 6 characters");
        return;
    }

    if (newPassword !== confirmPassword) {
        alert("❌ Passwords do not match");
        return;
    }

    const user = await getCurrentUser();
    if (!user) {
        alert("❌ Not authenticated");
        return;
    }

    // Update password
    const { data, error } = await supabaseClient.auth.updateUser({
        password: newPassword
    });

    if (error) {
        alert("❌ Error updating password: " + error.message);
    } else {
        alert("✅ Password changed successfully!");
        window.location.href = "profile.html";
    }
}
</script>
